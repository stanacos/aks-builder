# Ralphy Progress Log

- [✓] 2026-02-16 13:12 - Run `az aks get-versions --location norwayeast` to confirm K8s 1.34.x availability and exact patch version (REQ-002)
- [✓] 2026-02-16 13:13 - Run `az vm list-skus --location norwayeast --size Standard_D4` to confirm D-series v6 availability (REQ-002)
- [✓] 2026-02-16 13:19 - Update all API versions in `bicep/main.bicep` per the API Version Upgrade Map table (REQ-001)
- [✓] 2026-02-16 13:23 - Update all API versions in `bicep/network.bicep` -- 9 resources from 2020/2023 to 2024/2025 (REQ-001)
- [✓] 2026-02-16 13:25 - Update all API versions in `bicep/firewall.bicep` -- 4 resources from 2023 to 2025 (REQ-001)
- [✓] 2026-02-16 13:28 - Update all API versions in `bicep/nsg.bicep` -- 12 resources from 2022/2023 to 2025 (REQ-001)
- [✓] 2026-02-16 13:29 - Update API versions in `bicep/keyvault.bicep` and `bicep/keyvaultkey.bicep` from 2022 to 2025 (REQ-001)
- [✓] 2026-02-16 13:31 - Update API versions in `bicep/aksagentpool.bicep` from 2024-01-01 to 2025-10-01 (REQ-001)
- [✓] 2026-02-16 13:32 - Update API versions in `bicep/appgw.bicep` from 2023 to 2025 (REQ-001)
- [✓] 2026-02-16 13:35 - Update API versions in `bicep/dnsZone.bicep` from 2018/2020 to 2023/2024 (REQ-001)
- [✓] 2026-02-16 13:37 - Update API versions in `bicep/networkwatcherflowlog.bicep` from 2022/2023 to 2025 (REQ-001)
- [✓] 2026-02-16 13:42 - Scan all remaining `bicep/*.bicep` files for outdated API versions and update them (REQ-001)
- [✓] 2026-02-16 13:45 - Update parameter defaults in `bicep/main.bicep`: kubernetesVersion, osSKU, networkPluginMode, networkDataplane, aksOutboundTrafficType, natGwIpCount, natGwIdleTimeout, agentVMSize, podCidr, agentCount, maxCount (REQ-002)
- [✓] 2026-02-16 13:47 - Update `systemPoolPresets` variable in `bicep/main.bicep`: Standard pool count 3->1, maxCount 5->3, remove availability zones, update VM SKU to v6 (REQ-002)
- [✓] 2026-02-16 13:50 - Update system pool OS SKU logic in `bicep/main.bicep` to hardcode `'AzureLinux'` (REQ-002)
- [✓] 2026-02-16 14:02 - Run `az bicep build --file bicep/main.bicep` and fix any errors or warnings until clean (REQ-001, REQ-002)
- [✓] 2026-02-16 14:15 - Update all default values in `helper/src/config.json` to match new Bicep defaults: kubernetesVersion, location, osSKU, vmSize, agentCount, maxCount, networkPluginMode, networkDataplane, aksOutboundTrafficType, natGwIpCount, natGwIdleTimeout, podCidr, maxPods, ingress (REQ-003)
- [✓] 2026-02-16 14:19 - Create `helper/src/configpresets/lab.json` with Lab preset: lean cluster, no monitoring/registry/ingress, stable upgrade, autoscale 1-3 (REQ-004)
- [✓] 2026-02-16 14:23 - Create `helper/src/configpresets/securelab.json` with Secure Lab preset: AAD+RBAC, Azure Policy audit, Cilium network policy, Basic ACR, Azure Monitor, KV CSI, workload identity (REQ-004)
- [✓] 2026-02-16 14:35 - Update `helper/src/index.js` to import lab.json and securelab.json instead of the 4 old preset files (REQ-004)
- [✓] 2026-02-16 16:04 - Remove old preset files: `baselines.json`, `entScale.json`, `gaming.json`, `principals.json` (REQ-004)
- [✓] 2026-02-16 16:05 - Update default preset key in `helper/src/components/portalnav.js` from `'defaultOps'` to the Lab preset default card key (REQ-004)
- [✓] 2026-02-16 16:09 - Run `npm start` and verify UI loads with new defaults and presets render correctly (REQ-003, REQ-004)
- [✓] 2026-02-16 16:10 - Create `helper/src/nintendoNames.js` with 35+ Nintendo characters and `generateNintendoClusterName()` function returning `{character}-{3digits}` format (REQ-005)
- [✓] 2026-02-16 16:13 - Verify all Nintendo character names produce cluster names <= 20 characters total (REQ-005)
- [✓] 2026-02-16 16:16 - Update `helper/src/components/portalnav.js` to import and use `generateNintendoClusterName()` for initial cluster name (REQ-005)
- [✓] 2026-02-16 16:18 - Add `subscription` field to `helper/src/config.json` deploy defaults with value `1869051d-48fc-4985-8631-addf990c15da` (REQ-006)
- [✓] 2026-02-16 16:20 - Update `helper/src/components/deployTab.js` to prepend `az account set --subscription` command in Bash output (REQ-006)
- [✓] 2026-02-16 16:23 - Update PowerShell deploy command in `deployTab.js` to include subscription setting (REQ-006)
- [✓] 2026-02-16 16:27 - Move `networkDataplane` from `preview_params` to `params` in `deployTab.js` since Cilium is GA (REQ-007)
- [✓] 2026-02-16 16:40 - Run `npm start` and verify: Nintendo name in cluster field, subscription in deploy command, Cilium in main params (REQ-005, REQ-006, REQ-007)
- [✓] 2026-02-16 16:47 - Update `helper/package.json` dependencies: react 18.3.1, react-dom 18.3.1, @fluentui/react 8.125.4, @fluentui/azure-themes latest 8.x, @playwright/test 1.50+, applicationinsights-web 3.3.0, web-vitals 4.2.0 (REQ-008)
- [✓] 2026-02-16 16:49 - Remove `playwright-expect` from package.json devDependencies (REQ-008)
- [✓] 2026-02-16 16:52 - Run `npm install` and resolve any peer dependency conflicts (REQ-008)
- [✓] 2026-02-16 16:54 - Run `npm audit` and fix any critical/high vulnerabilities (REQ-008)
- [✓] 2026-02-16 16:57 - Run `npm start` and verify UI still works after dependency upgrades (REQ-008)
- [✓] 2026-02-16 16:58 - Update `helper-test-managednatgw.spec.js` to expect NAT Gateway as the default egress option instead of Load Balancer (REQ-009)
- [✓] 2026-02-16 17:00 - Update `helper-test-main-presets.spec.js` to use new Lab/Secure Lab preset URL parameters (REQ-009)
- [✓] 2026-02-16 17:02 - Update `helper-export-az-commands.spec.js` to use new preset data-testid selectors (REQ-009)
- [✓] 2026-02-16 17:03 - Remove all `playwright-expect` imports and `expect.extend(matchers)` calls from test files; replace `toMatchText()` with native Playwright `toHaveText()` (REQ-009)
- [✓] 2026-02-16 17:08 - Review and update any other test files referencing old preset keys or outdated default values (REQ-009)
- [✓] 2026-02-16 17:09 - Run full Playwright test suite: `npx playwright test --browser chromium .playwrighttests/ --reporter list` and fix all failures (REQ-009)
- [✓] 2026-02-16 17:13 - Update cert-manager reference version in `postdeploy/scripts/certmanager-install.sh` from v1.8.0 to v1.17.x LTS (REQ-010)
- [✓] 2026-02-16 17:14 - Update `postdeploy/helm/certmanagerissuer/Chart.yaml` appVersion and bump chart version to 0.4.0 (REQ-010)
- [✓] 2026-02-16 17:16 - Update `postdeploy/helm/externaldns/Chart.yaml` appVersion from v0.11.0 to v0.15.1 and bump chart version to 0.4.0 (REQ-010)
- [✓] 2026-02-16 17:17 - Update `postdeploy/helm/externaldns/values.yaml` image registry from `k8s.gcr.io` to `registry.k8s.io` and update tag (REQ-010)
- [✓] 2026-02-16 17:20 - Remove old Helm chart packages: `Az-CertManagerIssuer-0.3.0.tgz`, `externaldns-0.3.0.tgz`, `externaldns-0.2.0.tgz` (REQ-010)
- [✓] 2026-02-16 17:23 - Build new Helm chart packages with `helm package` (REQ-010)
- [✓] 2026-02-16 17:24 - Run `helm lint` on both updated chart directories (REQ-010)
